name: CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # Job 1: Python Linting & Testing (for the /converter)
  python-lint-test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # Install linting tools
        pip install flake8 pylint

    - name: Lint Python code
      run: |
        # Run flake8 on converter directory
        flake8 converter/
        # Run pylint on converter directory
        pylint converter/

    - name: Test Python converter import
      run: |
        # Test that the converter scripts can be imported without errors
        python -c "import converter.build; print('build.py imported successfully')"
        python -c "import converter.convert_to_web; print('convert_to_web.py imported successfully')"
        python -c "import converter.debug_converter; print('debug_converter.py imported successfully')"

  # Job 2: Next.js Linting & Build (for the /webapp)
  nextjs-lint-build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18.x'
        cache: 'npm'
        cache-dependency-path: webapp/package-lock.json

    - name: Install dependencies
      run: |
        cd webapp
        npm ci

    - name: Run Next.js linter
      run: |
        cd webapp
        npm run lint

    - name: Build Next.js app
      run: |
        cd webapp
        npm run build